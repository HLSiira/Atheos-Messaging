<?php

//////////////////////////////////////////////////////////////////////////////80
//  Atheos Messaging
//////////////////////////////////////////////////////////////////////////////80
// Copyright (c) 2020 Liam Siira (liam@siira.io), distributed as-is and without
// warranty under the MIT License. See [root]/license.md for more.
// This information must remain intact.
//////////////////////////////////////////////////////////////////////////////80
// Copyright (c) 2016 Codiad & RustyGumbo
// Source: https://github.com/RustyGumbo/Codiad-Messaging
//////////////////////////////////////////////////////////////////////////////80

require_once('class.message.php');

$user = SESSION("user");

$Message = new Message($user);

switch ($action) {

	//////////////////////////////////////////////////////////////////////////80
	// Send a message.
	//////////////////////////////////////////////////////////////////////////80
	case 'send':
		$recipient = POST("recipient");
		$text = POST("text");
		$Message->send($recipient, $text);
		break;

	//////////////////////////////////////////////////////////////////////////80
	// Check for a new message.
	//////////////////////////////////////////////////////////////////////////80
	case 'check':
		$Message->check();
		break;

	//////////////////////////////////////////////////////////////////////////80
	// Mark all messages as read.
	//////////////////////////////////////////////////////////////////////////80
	case 'markAllRead':
		$Message->markAllRead();
		Common::sendJSON("S2000");
		break;

	//////////////////////////////////////////////////////////////////////////80
	// Default no action
	//////////////////////////////////////////////////////////////////////////80
	default:
		Common::sendJSON("E401i");
		die;
		break;
}